<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Honeywell Bolt Torque Calculator</title>
    <!-- Include jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #0046ad;
            margin-bottom: 5px;
        }
        h2 {
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 8px;
            margin-top: 25px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 0.9em;
        }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        input[readonly] {
            background-color: #f5f5f5;
        }
        .help-text {
            font-size: 0.8em;
            color: #666;
            margin-top: 3px;
        }
        button {
            background-color: #0046ad;
            color: white;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }
        button:hover {
            background-color: #003380;
        }
        .export-btn {
            background-color: #28a745;
        }
        .export-btn:hover {
            background-color: #218838;
        }
        .results {
            margin-top: 30px;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            padding: 20px;
            background-color: #f8fff9;
            display: none;
        }
        .results h2 {
            color: #155724;
            border-bottom: 1px solid #c3e6cb;
        }
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
        .torque-value {
            font-size: 24px;
            font-weight: bold;
            color: #155724;
            margin-bottom: 5px;
        }
        .stress-value {
            font-size: 24px;
            font-weight: bold;
            color: #0046ad;
            margin-bottom: 5px;
        }
        .torque-passes {
            background-color: white;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #c3e6cb;
            margin-top: 15px;
        }
        .stress-box {
            background-color: white;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #b8daff;
            margin-top: 15px;
        }
        .torque-pass {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .formula-box {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
        ul {
            padding-left: 20px;
        }
        .notes {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 25px;
            font-size: 0.9em;
        }
        .button-group {
            display: flex;
            gap: 10px;
        }
        @media (max-width: 576px) {
            .button-group {
                flex-direction: column;
            }
        }
        .documentation-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background-color: #f8f9fa;
        }
        .colored-text {
            color: #155724;
            font-weight: bold;
        }
        .warning-text {
            color: #dc3545;
            font-weight: bold;
        }
        .info-box {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #17a2b8;
            margin: 10px 0;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-top: none;
        }
        .active-tab {
            display: block;
        }
        .tab-button {
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            cursor: pointer;
            padding: 10px 20px;
            margin-right: 2px;
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
        }
        .tab-button.active {
            background-color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Honeywell Bolt Torque Calculator</h1>
        <div class="subtitle">Based on Honeywell SOP-MNT-539 Bolt Torque Procedure</div>

        <!-- Documentation Section - Reordered as requested -->
        <div class="documentation-section">
            <h2 style="margin-top: 0;">Documentation Information</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="unitId">Unit ID:</label>
                    <input type="text" id="unitId" placeholder="e.g., HF,AR,125,245,YF">
                </div>
                <div class="form-group">
                    <label for="equipmentId">Equipment ID:</label>
                    <input type="text" id="equipmentId" placeholder="e.g., U-6101, E-201">
                </div>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label for="lineNumber">Line Number:</label>
                    <input type="text" id="lineNumber" placeholder="e.g., PF11212C">
                </div>
            <div class="form-group">
                    <label for="pipingSpec">Piping Specification:</label>
                    <input type="text" id="pipingSpec" placeholder="Enter piping specification (e.g., PZB, CWR, SM)">
            </div>
         </div>
    </div>
    
        <div class="form-grid">
            <div>
                <div class="section">
                    <h2 style="margin-top: 0;">Flange Information</h2>
                    
                    <div class="form-group">
                        <label for="flangeSize">Flange Size (inches):</label>
                        <select id="flangeSize">
                            <option value="">Select Flange Size</option>
                            <option value="0.5">1/2 inch</option>
                            <option value="1">1 inch</option>
                            <option value="1.5">1-1/2 inch</option>
                            <option value="2">2 inch</option>
                            <option value="3">3 inch</option>
                            <option value="4">4 inch</option>
                            <option value="6">6 inch</option>
                            <option value="8">8 inch</option>
                            <option value="10">10 inch</option>
                            <option value="12">12 inch</option>
                            <option value="14">14 inch</option>
                            <option value="16">16 inch</option>
                            <option value="18">18 inch</option>
                            <option value="20">20 inch</option>
                            <option value="24">24 inch</option>
                            <option value="30">30 inch</option>
                            <option value="36">36 inch</option>
                            <option value="42">42 inch</option>
                            <option value="48">48 inch</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="flangeRating">Flange Rating:</label>
                        <select id="flangeRating">
                            <option value="">Select Flange Rating</option>
                            <option value="150">Class 150</option>
                            <option value="300">Class 300</option>
                            <option value="600">Class 600</option>
                            <option value="900">Class 900</option>
                            <option value="1500">Class 1500</option>
                            <option value="2500">Class 2500</option>
                            <option value="RTJ">RTJ (Ring Type Joint)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="numberOfBolts">Number of Bolts:</label>
                        <input type="number" id="numberOfBolts" min="1" value="1">
                        <div class="help-text">Auto-filled based on flange size and rating (can be manually overridden)</div>
                    </div>
                </div>

                <div class="section">
                    <h2 style="margin-top: 0;">Bolt Information</h2>
                    
                    <div class="form-group">
                        <label for="boltMaterial">Bolt Material (BM):</label>
                        <select id="boltMaterial">
                            <option value="">Select Bolt Material</option>
                            <option value="a193_b7">A-193 B7 (Chrome-Moly Alloy Steel)</option>
                            <option value="a193_b7m">A-193 B7M (Chrome-Moly Alloy Steel)</option>
                            <option value="a320_l7m">A-320 L7M (Low Temp Chrome-Moly Steel)</option>
                            <option value="a193_b8">A-193 B8 (304 Stainless Steel)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="boltDiameter">Bolt Diameter (BD):</label>
                        <select id="boltDiameter">
                            <option value="">Select Bolt Diameter</option>
                            <option value="0.25">1/4 inch</option>
                            <option value="0.3125">5/16 inch</option>
                            <option value="0.375">3/8 inch</option>
                            <option value="0.4375">7/16 inch</option>
                            <option value="0.5">1/2 inch</option>
                            <option value="0.5625">9/16 inch</option>
                            <option value="0.625">5/8 inch</option>
                            <option value="0.75">3/4 inch</option>
                            <option value="0.875">7/8 inch</option>
                            <option value="1">1 inch</option>
                            <option value="1.125">1-1/8 inch</option>
                            <option value="1.25">1-1/4 inch</option>
                            <option value="1.375">1-3/8 inch</option>
                            <option value="1.5">1-1/2 inch</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="temperature">Temperature:</label>
                        <select id="temperature">
                            <option value="">Select Temperature</option>
                            <option value="-20_100">-20 to 100 °F</option>
                            <option value="200">200 °F</option>
                            <option value="300">300 °F</option>
                            <option value="400">400 °F</option>
                            <option value="500">500 °F</option>
                            <option value="600">600 °F</option>
                            <option value="700">700 °F</option>
                        </select>
                    </div>
                </div>

                <!-- New Gasket Information Section -->
                <div class="section">
                    <h2 style="margin-top: 0;">Gasket Information</h2>
                    
                    <div class="form-group">
                        <label for="gasketType">Gasket Type:</label>
                        <select id="gasketType" onchange="updateGasketTypeInfo()">
    <option value="">Select Gasket Type</option>
    <option value="none">None</option>
    <option value="taskline">Taskline</option>
    <option value="kammprofile">Kammprofile</option>
    <option value="spiral">Spiral Wound</option>
    <option value="full-face">Full Face</option>
    <option value="ring">Ring Type</option>
    <option value="rtj">RTJ (Ring Type Joint)</option>
    <!-- Add the new option here: -->
    <option value="gore_upg">Gore UPG</option>
</select>
                    </div>

                    <div class="form-group">
                        <label for="internalDesignPressure">Internal Design Pressure (psi):</label>
                        <input type="number" id="internalDesignPressure" min="0" step="0.1">
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="flangeSeatingOD">Flange Seating OD (inches):</label>
                            <input type="number" id="flangeSeatingOD" min="0" step="0.001">
                        </div>
                        <div class="form-group">
                            <label for="flangeSeatingID">Flange Seating ID (inches):</label>
                            <input type="number" id="flangeSeatingID" min="0" step="0.001">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="gasketOD">Gasket OD (inches):</label>
                            <input type="number" id="gasketOD" min="0" step="0.001">
                        </div>
                        <div class="form-group">
                            <label for="gasketID">Gasket ID (inches):</label>
                            <input type="number" id="gasketID" min="0" step="0.001">
                        </div>
                    </div>

                    <div id="partitionBlock" class="form-grid" style="display: none;">
                        <div class="form-group">
                            <label for="partitionWidth">Partition Width (inches):</label>
                            <input type="number" id="partitionWidth" min="0" step="0.001">
                        </div>
                        <div class="form-group">
                            <label for="partitionLength">Partition Length (inches):</label>
                            <input type="number" id="partitionLength" min="0" step="0.001">
                        </div>
                    </div>

                    <div id="boltHolesBlock" class="form-group" style="display: none;">
                        <label for="boltHolesInGasket">Number of Bolt Holes in Gasket (Flat Face Flanges):</label>
                        <input type="number" id="boltHolesInGasket" min="0" step="1">
                        <div class="help-text">Auto-filled from flange information (can be manually adjusted)</div>
                    </div>

                    <div class="form-group">
                        <label for="boltDiameterGasket">Bolt Diameter (inches):</label>
                        <input type="text" id="boltDiameterGasket" readonly>
                        <div class="help-text">Auto-filled from bolt information</div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="minCompressionStress">Min. Compression Stress (psi):</label>
                            <input type="number" id="minCompressionStress" min="0">
                        </div>
                        <div class="form-group">
                            <label for="maxCompressionStress">Max. Compression Stress (psi):</label>
                            <input type="number" id="maxCompressionStress" min="0">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="gasketArea">Gasket Area (sq. inches):</label>
                        <input type="text" id="gasketArea" readonly>
                        <div class="help-text">Calculated from gasket dimensions</div>
                        <button id="calculateAreaBtn" style="margin-top: 10px; background-color: #17a2b8;" onclick="calculateGasketArea()">Calculate Gasket Area</button>
                    </div>
                </div>
            </div>

            <div>
                <div class="section">
                    <h2 style="margin-top: 0;">Calculation Parameters</h2>

                    <div class="form-group">
                        <label for="yieldStrength">Yield Strength (YS) (psi):</label>
                        <input type="text" id="yieldStrength" readonly>
                        <div class="help-text">Auto-filled from Table 10.1 in procedure</div>
                    </div>

                    <div class="form-group">
                        <label for="percentYield">Percentage of Yield (PY):</label>
                        <select id="percentYield">
                            <option value="0.30">30%</option>
                            <option value="0.35">35%</option>
                            <option value="0.40">40%</option>
                            <option value="0.45">45%</option>
                            <option value="0.50">50%</option>
                            <option value="0.55">55%</option>
                            <option value="0.60">60%</option>
                            <option value="0.65">65%</option>
                            <option value="0.70" selected>70% (Recommended)</option>
                            <option value="0.80">80%</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="threadType">Thread Type:</label>
                        <select id="threadType">
                            <option value="">Select Thread Type</option>
                            <option value="UNC">UNC (Coarse Thread)</option>
                            <option value="UNF">UNF (Fine Thread)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="studStressArea">Stud Stress Area (SA) (sq.in.):</label>
                        <input type="text" id="studStressArea" readonly>
                        <div class="help-text">Auto-filled from Table 10.2 in procedure</div>
                    </div>

                    <div class="form-group">
                        <label for="lubricationCondition">Lubrication Condition:</label>
                        <select id="lubricationCondition">
                            <option value="">Select Lubrication</option>
                            <option value="dry">Dry (Carbon Steel on Carbon steel)</option>
                            <option value="never_seize">Never-Seize (paste)</option>
                            <option value="teflon">Teflon Coating</option>
                            <option value="moly">Moly Paste</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="frictionFactor">Friction Factor (K):</label>
                        <input type="text" id="frictionFactor" readonly>
                        <div class="help-text">Auto-filled from Table 10.4 in procedure</div>
                    </div>

                    <div id="gasketInfoDisplay" class="info-box" style="display: none;">
                        <h4 style="margin-top: 0;">Gasket Information</h4>
                        <div id="gasketInfoContent"></div>
                    </div>

                    <button id="calculateButton">Calculate Torque & Seating Stress</button>
                </div>
            </div>
        </div>

        <div id="results" class="results">
            <h2>Calculation Results</h2>
            
            <div class="tab-buttons" style="display: flex; margin-bottom: -1px;">
                <button class="tab-button active" onclick="showTab('torqueTab')">Torque Results</button>
                <button class="tab-button" onclick="showTab('gasketTab')">Gasket Seating Stress</button>
            </div>
            
            <div id="torqueTab" class="tab-content active-tab">
                <div class="results-grid">
                    <div>
                        <h3>Documentation Information:</h3>
                        <ul id="docInfo"></ul>

                        <h3>Input Summary:</h3>
                        <ul id="inputSummary">
                        </ul>
                    </div>
                    
                    <div>
                        <h3>Calculation Steps:</h3>
                        <ul id="calculationSteps">
                        </ul>
                    </div>
                </div>
                
                <div class="torque-passes">
                    <h3>Torque Values:</h3>
                    <div id="torqueValue" class="torque-value"></div>
                    <div>Recommended Torque</div>
                    
                    <div style="margin-top: 15px;">
                        <div class="torque-pass">
                            <span>Pass 1 (30%):</span>
                            <span id="firstPassTorque" style="font-weight: bold;"></span>
                        </div>
                        <div class="torque-pass">
                            <span>Pass 2 (70%):</span>
                            <span id="secondPassTorque" style="font-weight: bold;"></span>
                        </div>
                        <div class="torque-pass">
                            <span>Pass 3 (100%):</span>
                            <span id="thirdPassTorque" style="font-weight: bold;"></span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4>Torque Formula Used:</h4>
                    <div class="formula-box">
                        TORQUE (T) = K × BL × (BD/12)
                    </div>
                    <p>Where:</p>
                    <ul id="formulaDetails">
                    </ul>
                </div>
            </div>
            
            <div id="gasketTab" class="tab-content">
                <div class="results-grid">
                    <div>
                        <h3>Gasket Information:</h3>
                        <ul id="gasketInfo"></ul>
                    </div>
                    
                    <div>
                        <h3>Seating Calculations:</h3>
                        <ul id="seatingCalculations"></ul>
                    </div>
                </div>
                
                <div class="stress-box">
                    <h3>Gasket Seating Stress:</h3>
                    <div id="seatingStressValue" class="stress-value"></div>
                    <div>Calculated Seating Stress</div>
                    
                    <div id="stressStatusContainer" style="margin-top: 15px; border-top: 1px solid #ddd; padding-top: 15px;">
                        <div id="stressStatus"></div>
                        <div id="stressRecommendation" style="margin-top: 10px;"></div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4>Seating Stress Formula:</h4>
                    <div class="formula-box">
                        SEATING STRESS = TOTAL BOLT LOAD / GASKET AREA
                    </div>
                    <p>Where:</p>
                    <ul id="stressFormulaDetails">
                    </ul>
                </div>
            </div>
            
            <div class="button-group" style="margin-top: 20px;">
                <button id="exportPdfBtn" class="export-btn">Export to PDF</button>
            </div>
        </div>

        <div class="notes">
            <p><strong>Notes:</strong></p>
            <ul>
                <li>Follow the Honeywell Bolt Torque Procedure SOP-MNT-539 for proper torquing sequence.</li>
                <li>For critical applications, always consult with engineering.</li>
                <li>70% of yield is the recommended target for most applications.</li>
                <li>A post start-up hot or cold torque is required if operating temperatures exceed 300°F or are below 32°F.</li>
                <li>Adequate gasket seating stress is critical for proper joint integrity and leak prevention.</li>
            </ul>
        </div>
    </div>

    <script>
        // Reference tables from Honeywell procedure
        const boltYieldStrengthTable = {
    'a193_b7': {
        '-20_100': 105000,
        '200': 98000,
        '300': 94500,
        '400': 91700,
        '500': 88800,
        '600': 85700,
        '700': 81000
    },
    'a193_b7m': {
        '-20_100': 80000,
        '200': 74600,
        '300': 71700,
        '400': 69700,
        '500': 67400,
        '600': 65000,
        '700': 61400
    },
    'a320_l7m': {
        '-20_100': 80000,
        '200': 74600,
        '300': 71700,
        '400': 69700,
        '500': 67400,
        '600': 65000,
        '700': 61400
    },
    'a193_b8': {
        '-20_100': 30000,
        '200': 25000,
        '300': 22400,
        '400': 20700,
        '500': 19400,
        '600': 18400,
        '700': 17600
    }
};

        const studStressAreaTable = {
            '0.25': { 'UNC': 0.0318, 'UNF': 0.0364 },   // 1/4"
            '0.3125': { 'UNC': 0.0524, 'UNF': 0.0580 }, // 5/16"
            '0.375': { 'UNC': 0.0775, 'UNF': 0.0878 },  // 3/8"
            '0.4375': { 'UNC': 0.1063, 'UNF': 0.1187 }, // 7/16"
            '0.5': { 'UNC': 0.1419, 'UNF': 0.1599 },    // 1/2"
            '0.5625': { 'UNC': 0.1820, 'UNF': 0.2030 }, // 9/16"
            '0.625': { 'UNC': 0.2260, 'UNF': 0.2560 },  // 5/8"
            '0.75': { 'UNC': 0.3340, 'UNF': 0.3730 },   // 3/4"
            '0.875': { 'UNC': 0.4620, 'UNF': 0.5090 },  // 7/8"
            '1': { 'UNC': 0.6060, 'UNF': 0.6630 },      // 1"
            '1.125': { 'UNC': 0.7630, 'UNF': 0.8560 },  // 1-1/8"
            '1.25': { 'UNC': 0.9690, 'UNF': 1.0730 },   // 1-1/4"
            '1.375': { 'UNC': 1.1550, 'UNF': 1.3150 },  // 1-3/8"
            '1.5': { 'UNC': 1.4050, 'UNF': 1.5810 }     // 1-1/2"
        };

        const frictionFactorTable = {
            'dry': 0.20,        // Carbon Steel on Carbon steel
            'never_seize': 0.17, // Never-Seize (paste)
            'teflon': 0.12,     // Teflon Coating
            'moly': 0.13        // Moly Paste
        };

        // Gasket types with recommended compression stresses
        const gasketTypeInfo = {
    'none': {
        minStress: 0,
        maxStress: 0,
        description: 'No gasket used'
    },
    'taskline': {
        minStress: 2000,
        maxStress: 7500,
        description: 'Taskline gaskets are good for multiple temperature and pressure cycles'
    },
    'kammprofile': {
        minStress: 2500,
        maxStress: 72500,
        description: 'Kammprofile gaskets are excellent for high temperature and pressure applications'
    },
    'spiral': {
        minStress: 10000,
        maxStress: 50000,
        description: 'Spiral wound gaskets require higher torque for compression and are good for thermal cycling'
    },
    'full-face': {
        minStress: 1500,
        maxStress: 3000,
        description: 'Full face gaskets distribute load across the entire flange face'
    },
    'ring': {
        minStress: 2000,
        maxStress: 5000,
        description: 'Ring type gaskets fit between raised faces of flanges'
    },
    'rtj': {
        minStress: 30000,
        maxStress: 50000,
        description: 'Ring Type Joint (RTJ) gaskets provide high pressure sealing capability'
    },
    'gore_upg': {
        minStress: 2000,
        maxStress: 4500,
        description: 'Gore UPG (Universal Pipe Gasket) is a high-performance expanded PTFE gasket material with excellent chemical resistance and sealability'
    }
};

        // Flange bolt count lookup table (ANSI/ASME B16.5)
        const boltCountTable = {
            '0.5': { '150': 4, '300': 4, '600': 4, '900': 4, '1500': 4, '2500': 4, 'RTJ': 4 },
            '1': { '150': 4, '300': 4, '600': 4, '900': 4, '1500': 4, '2500': 4, 'RTJ': 4 },
            '1.5': { '150': 4, '300': 4, '600': 4, '900': 4, '1500': 4, '2500': 4, 'RTJ': 4 },
            '2': { '150': 4, '300': 8, '600': 8, '900': 8, '1500': 8, '2500': 8, 'RTJ': 8 },
            '3': { '150': 4, '300': 8, '600': 8, '900': 8, '1500': 8, '2500': 8, 'RTJ': 8 },
            '4': { '150': 8, '300': 8, '600': 8, '900': 8, '1500': 8, '2500': 8, 'RTJ': 8 },
            '6': { '150': 8, '300': 12, '600': 12, '900': 12, '1500': 12, '2500': 12, 'RTJ': 12 },
            '8': { '150': 8, '300': 12, '600': 12, '900': 16, '1500': 16, '2500': 16, 'RTJ': 16 },
            '10': { '150': 12, '300': 16, '600': 16, '900': 20, '1500': 20, '2500': 24, 'RTJ': 20 },
            '12': { '150': 12, '300': 16, '600': 20, '900': 20, '1500': 20, '2500': 24, 'RTJ': 20 },
            '14': { '150': 12, '300': 20, '600': 20, '900': 24, '1500': 24, '2500': 24, 'RTJ': 24 },
            '16': { '150': 16, '300': 20, '600': 24, '900': 28, '1500': 28, '2500': 28, 'RTJ': 28 },
            '18': { '150': 16, '300': 24, '600': 24, '900': 32, '1500': 32, '2500': 32, 'RTJ': 32 },
            '20': { '150': 20, '300': 24, '600': 28, '900': 36, '1500': 36, '2500': 36, 'RTJ': 36 },
            '24': { '150': 20, '300': 24, '600': 32, '900': 40, '1500': 40, '2500': 40, 'RTJ': 40 },
            '30': { '150': 24, '300': 28, '600': 36, '900': 48, '1500': 48, '2500': 52, 'RTJ': 48 },
            '36': { '150': 28, '300': 32, '600': 40, '900': 52, '1500': 56, '2500': 60, 'RTJ': 56 },
            '42': { '150': 32, '300': 36, '600': 44, '900': 56, '1500': 60, '2500': 64, 'RTJ': 60 },
            '48': { '150': 36, '300': 40, '600': 48, '900': 60, '1500': 64, '2500': 68, 'RTJ': 64 }
        };

        // Global variable to store calculation results for PDF export
        let calculationResults = null;

        // DOM Elements
        const unitIdInput = document.getElementById('unitId');
        const equipmentIdInput = document.getElementById('equipmentId');
        const lineNumberInput = document.getElementById('lineNumber');
        const pipingSpecInput = document.getElementById('pipingSpec');
        const flangeSizeSelect = document.getElementById('flangeSize');
        const flangeRatingSelect = document.getElementById('flangeRating');
        const numberOfBoltsInput = document.getElementById('numberOfBolts');
        const boltMaterialSelect = document.getElementById('boltMaterial');
        const boltDiameterSelect = document.getElementById('boltDiameter');
        const boltDiameterGasketInput = document.getElementById('boltDiameterGasket');
        const temperatureSelect = document.getElementById('temperature');
        const yieldStrengthInput = document.getElementById('yieldStrength');
        const percentYieldSelect = document.getElementById('percentYield');
        const threadTypeSelect = document.getElementById('threadType');
        const studStressAreaInput = document.getElementById('studStressArea');
        const lubricationConditionSelect = document.getElementById('lubricationCondition');
        const frictionFactorInput = document.getElementById('frictionFactor');
        const calculateButton = document.getElementById('calculateButton');
        const resultsDiv = document.getElementById('results');
        const exportPdfBtn = document.getElementById('exportPdfBtn');
        
        // Gasket-specific elements
        const gasketTypeSelect = document.getElementById('gasketType');
        const internalDesignPressureInput = document.getElementById('internalDesignPressure');
        const flangeSeatingODInput = document.getElementById('flangeSeatingOD');
        const flangeSeatingIDInput = document.getElementById('flangeSeatingID');
        const gasketODInput = document.getElementById('gasketOD');
        const gasketIDInput = document.getElementById('gasketID');
        const partitionWidthInput = document.getElementById('partitionWidth');
        const partitionLengthInput = document.getElementById('partitionLength');
        const boltHolesInGasketInput = document.getElementById('boltHolesInGasket');
        const minCompressionStressInput = document.getElementById('minCompressionStress');
        const maxCompressionStressInput = document.getElementById('maxCompressionStress');
        const gasketAreaInput = document.getElementById('gasketArea');
        const gasketInfoDisplay = document.getElementById('gasketInfoDisplay');
        const gasketInfoContent = document.getElementById('gasketInfoContent');

        // Event Listeners
        flangeSizeSelect.addEventListener('change', () => {
            updateBoltCount();
            updateBoltHolesInGasket();
        });
        flangeRatingSelect.addEventListener('change', () => {
            updateBoltCount();
            updateBoltHolesInGasket();
        });
        boltMaterialSelect.addEventListener('change', updateYieldStrength);
        temperatureSelect.addEventListener('change', updateYieldStrength);
        boltDiameterSelect.addEventListener('change', () => {
            updateStudStressArea();
            updateBoltDiameterGasket();
        });
        threadTypeSelect.addEventListener('change', updateStudStressArea);
        lubricationConditionSelect.addEventListener('change', updateFrictionFactor);
        numberOfBoltsInput.addEventListener('change', updateBoltHolesInGasket);
        calculateButton.addEventListener('click', calculateAll);
        exportPdfBtn.addEventListener('click', exportToPdf);

        // Tab functionality
        function showTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active-tab');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active-tab');
            
            // Add active class to clicked button
            event.currentTarget.classList.add('active');
        }

        // Function to update gasket type information
        function updateGasketTypeInfo() {
    const gasketType = gasketTypeSelect.value;
    const partitionBlock = document.getElementById('partitionBlock');
    const boltHolesBlock = document.getElementById('boltHolesBlock');
    
    // Show/hide appropriate fields based on gasket type
    if (gasketType === 'full-face') {
        boltHolesBlock.style.display = 'block';
        partitionBlock.style.display = 'none';
        updateBoltHolesInGasket();
    } else if (gasketType === 'ring' || gasketType === 'rtj') {
        boltHolesBlock.style.display = 'none';
        partitionBlock.style.display = 'none';
    } else {
        boltHolesBlock.style.display = 'none';
        partitionBlock.style.display = 'none';
    }
    
    // Update min/max compression stress based on gasket type
    if (gasketType && gasketTypeInfo[gasketType]) {
        minCompressionStressInput.value = gasketTypeInfo[gasketType].minStress;
        maxCompressionStressInput.value = gasketTypeInfo[gasketType].maxStress;
        
        // Display gasket info
        gasketInfoDisplay.style.display = 'block';
        gasketInfoContent.innerHTML = `
            <p><strong>${getGasketTypeLabel(gasketType)}</strong>: ${gasketTypeInfo[gasketType].description}</p>
            <p>Recommended compression stress range: ${gasketTypeInfo[gasketType].minStress.toLocaleString()} - ${gasketTypeInfo[gasketType].maxStress.toLocaleString()} psi</p>
        `;
    } else {
        minCompressionStressInput.value = '';
        maxCompressionStressInput.value = '';
        gasketInfoDisplay.style.display = 'none';
    }
}

        // Function to update bolt diameter in gasket section
        function updateBoltDiameterGasket() {
            const boltDiameter = boltDiameterSelect.value;
            if (boltDiameter) {
                boltDiameterGasketInput.value = `${getBoltSizeLabel(boltDiameter)} inch`;
            } else {
                boltDiameterGasketInput.value = '';
            }
        }

        // Function to update bolt holes in gasket field
        function updateBoltHolesInGasket() {
            const numberOfBolts = numberOfBoltsInput.value;
            if (numberOfBolts) {
                boltHolesInGasketInput.value = numberOfBolts;
            }
        }

        // Function to calculate gasket area
        function calculateGasketArea() {
    const gasketType = gasketTypeSelect.value;
    const gasketOD = parseFloat(gasketODInput.value);
    const gasketID = parseFloat(gasketIDInput.value);
    const boltHolesInGasket = parseInt(boltHolesInGasketInput.value) || 0;
    const boltDiameter = parseFloat(boltDiameterSelect.value) || 0;
    const flangeSeatingOD = parseFloat(flangeSeatingODInput.value) || 0;
    const flangeSeatingID = parseFloat(flangeSeatingIDInput.value) || 0;
    const partitionWidth = parseFloat(partitionWidthInput.value) || 0;
    const partitionLength = parseFloat(partitionLengthInput.value) || 0;
    
    if (!gasketType) {
        alert("Please select a gasket type.");
        return;
    }
    
    if (isNaN(gasketOD) || isNaN(gasketID)) {
        alert("Please enter valid gasket dimensions.");
        return;
    }
    
    let gasketArea = 0;
    
    // Calculate area based on gasket type
    switch(gasketType) {
        case 'full-face':
            // For full-face gaskets, calculate the basic area and subtract bolt holes
            // Bolt hole diameter typically 1/8" (0.125) larger than bolt diameter
            const basicArea = Math.PI / 4 * (Math.pow(gasketOD, 2) - Math.pow(gasketID, 2));
            const boltHoleDiameter = boltDiameter + 0.125; // Add clearance
            const holeArea = boltHolesInGasket * Math.PI * Math.pow(boltHoleDiameter, 2) / 4;
            gasketArea = basicArea - holeArea;
            break;
            
        case 'ring':
            // For ring gaskets, use either gasket dimensions or flange seating dimensions
            // if provided
            if (flangeSeatingOD > 0 && flangeSeatingID > 0) {
                // Use effective seating area if provided
                gasketArea = Math.PI / 4 * (Math.pow(flangeSeatingOD, 2) - Math.pow(flangeSeatingID, 2));
            } else {
                gasketArea = Math.PI / 4 * (Math.pow(gasketOD, 2) - Math.pow(gasketID, 2));
            }
            break;
            
        case 'spiral':
            // For spiral wound gaskets, calculate based on the effective sealing width
            // Default to standard dimensions if seating dimensions not provided
            let sealingOD, sealingID;
            if (flangeSeatingOD > 0 && flangeSeatingID > 0) {
                sealingOD = flangeSeatingOD;
                sealingID = flangeSeatingID;
            } else {
                // Typical spiral wound gasket has a sealing element with effective width
                // that's slightly less than the overall width
                const effectiveWidth = (gasketOD - gasketID) * 0.8; // 80% of overall width
                sealingOD = gasketOD - (gasketOD - gasketID) * 0.1;
                sealingID = gasketID + (gasketOD - gasketID) * 0.1;
            }
            gasketArea = Math.PI / 4 * (Math.pow(sealingOD, 2) - Math.pow(sealingID, 2));
            break;
            
        case 'kammprofile':
            // Kammprofile gaskets typically use the full gasket face area
            // but may have specific seating areas
            if (flangeSeatingOD > 0 && flangeSeatingID > 0) {
                gasketArea = Math.PI / 4 * (Math.pow(flangeSeatingOD, 2) - Math.pow(flangeSeatingID, 2));
            } else {
                gasketArea = Math.PI / 4 * (Math.pow(gasketOD, 2) - Math.pow(gasketID, 2));
            }
            break;
            
        case 'rtj':
            // Ring Type Joint (RTJ) gaskets have a more complex geometry
            // This is a simplified calculation - a true RTJ calculation would need more parameters
            const rtjEffectiveWidth = (gasketOD - gasketID) * 0.7; // Effective width is less than actual width
            gasketArea = Math.PI * ((gasketOD + gasketID) / 2) * rtjEffectiveWidth;
            break;
            
        case 'taskline':
            // Taskline gaskets typically use the full gasket face area
            // but may have specific seating areas
            if (flangeSeatingOD > 0 && flangeSeatingID > 0) {
                gasketArea = Math.PI / 4 * (Math.pow(flangeSeatingOD, 2) - Math.pow(flangeSeatingID, 2));
            } else {
                gasketArea = Math.PI / 4 * (Math.pow(gasketOD, 2) - Math.pow(gasketID, 2));
            }
            break;
            
        default:
            // Default calculation for other gasket types
            gasketArea = Math.PI / 4 * (Math.pow(gasketOD, 2) - Math.pow(gasketID, 2));
    }
    
    // Make sure we don't return a negative area (could happen with bad inputs)
    gasketArea = Math.max(0, gasketArea);
    
    // Display calculated area
    gasketAreaInput.value = gasketArea.toFixed(4);
    
    // Provide feedback about the calculation
    let feedback = "";
    if (gasketType === 'full-face') {
        feedback = "Area calculation includes deduction for bolt holes.";
    } else if (gasketType === 'rtj') {
        feedback = "RTJ area is an approximation based on effective contact surface.";
    } else if (gasketType === 'spiral') {
        feedback = "Calculation based on effective sealing width of spiral wound element.";
    }
    
    if (feedback) {
        // Display feedback in the gasket info area
        const currentContent = gasketInfoContent.innerHTML;
        // Only add the feedback if it's not already there
        if (!currentContent.includes(feedback)) {
            gasketInfoContent.innerHTML += `<p><em>${feedback}</em></p>`;
        }
    }
}

        // Function to update number of bolts based on flange size and rating
        function updateBoltCount() {
            const flangeSize = flangeSizeSelect.value;
            const flangeRating = flangeRatingSelect.value;
            
            if (flangeSize && flangeRating && 
                boltCountTable[flangeSize] && 
                boltCountTable[flangeSize][flangeRating]) {
                numberOfBoltsInput.value = boltCountTable[flangeSize][flangeRating];
            }
        }

        // Update functions
        function updateYieldStrength() {
            const boltMaterial = boltMaterialSelect.value;
            const temperature = temperatureSelect.value;

            if (boltMaterial && temperature && boltYieldStrengthTable[boltMaterial] && boltYieldStrengthTable[boltMaterial][temperature]) {
                yieldStrengthInput.value = boltYieldStrengthTable[boltMaterial][temperature].toLocaleString();
            } else {
                yieldStrengthInput.value = '';
            }
        }

        function updateStudStressArea() {
            const boltDiameter = boltDiameterSelect.value;
            const threadType = threadTypeSelect.value;

            if (boltDiameter && threadType && studStressAreaTable[boltDiameter] && studStressAreaTable[boltDiameter][threadType]) {
                studStressAreaInput.value = studStressAreaTable[boltDiameter][threadType].toFixed(4);
            } else {
                studStressAreaInput.value = '';
            }
        }

        function updateFrictionFactor() {
            const lubrication = lubricationConditionSelect.value;

            if (lubrication && frictionFactorTable[lubrication]) {
                frictionFactorInput.value = frictionFactorTable[lubrication].toFixed(2);
            } else {
                frictionFactorInput.value = '';
            }
        }

        // Function to validate all inputs 
        function validateInputs() {
            if (!boltDiameterSelect.value) {
                alert("Please select a Bolt Diameter.");
                return false;
            }
            if (!boltMaterialSelect.value) {
                alert("Please select a Bolt Material.");
                return false;
            }
            if (!temperatureSelect.value) {
                alert("Please select a Temperature.");
                return false;
            }
            if (!threadTypeSelect.value) {
                alert("Please select a Thread Type.");
                return false;
            }
            if (!lubricationConditionSelect.value) {
                alert("Please select a Lubrication Condition.");
                return false;
            }
            if (!yieldStrengthInput.value) {
                alert("Yield Strength could not be determined. Please check your selections.");
                return false;
            }
            if (!studStressAreaInput.value) {
                alert("Stud Stress Area could not be determined. Please check your selections.");
                return false;
            }
            if (!frictionFactorInput.value) {
                alert("Friction Factor could not be determined. Please check your selections.");
                return false;
            }
            
            // Check gasket inputs if gasket type is selected
            if (gasketTypeSelect.value) {
                if (!gasketODInput.value || !gasketIDInput.value) {
                    alert("Please enter gasket dimensions (OD and ID).");
                    return false;
                }
                
                if (!gasketAreaInput.value) {
                    alert("Please calculate gasket area before proceeding.");
                    return false;
                }
                
                if (!minCompressionStressInput.value || !maxCompressionStressInput.value) {
                    alert("Please enter minimum and maximum compression stress values.");
                    return false;
                }
            }
            
            return true;
        }

        // Function to calculate both torque and seating stress
        function calculateAll() {
            // Validate all inputs
            if (!validateInputs()) {
                return;
            }

            // Calculate torque
            calculateTorque();
            
            // Calculate seating stress if gasket info is provided
            if (gasketTypeSelect.value) {
                calculateSeatingStress();
            }
            
            // Show results
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Calculate Torque Function
        function calculateTorque() {
            // Get documentation values
            const unitId = unitIdInput.value || "Not specified";
            const equipmentId = equipmentIdInput.value || "Not specified";
            const lineNumber = lineNumberInput.value || "Not specified";
            const pipingSpec = pipingSpecInput.value || "Not specified";

            // Get values
            const flangeSize = flangeSizeSelect.value;
            const flangeRating = flangeRatingSelect.value;
            const boltDiameter = parseFloat(boltDiameterSelect.value);
            const yieldStrength = parseFloat(yieldStrengthInput.value.replace(/,/g, ''));
            const percentYield = parseFloat(percentYieldSelect.value);
            const studStressArea = parseFloat(studStressAreaInput.value);
            const frictionFactor = parseFloat(frictionFactorInput.value);
            const numberOfBolts = parseInt(numberOfBoltsInput.value) || 1;

            // Calculate according to Honeywell procedure
            // Step 1: Calculate Stress (S) = YS * PY
            const stress = yieldStrength * percentYield;
            
            // Step 2: Calculate Bolt Load (BL) = S * SA
            const boltLoad = stress * studStressArea;
            
            // Step 3: Calculate Total Bolt Load = BL * Number of Bolts
            const totalBoltLoad = boltLoad * numberOfBolts;
            
            // Step 4: Calculate Torque (T) = K * BL * (BD/12)
            // Note: Division by 12 converts to foot-pounds
            const torque = frictionFactor * boltLoad * (boltDiameter/12);
            
            // Calculate torque passes
            const firstPassTorque = torque * 0.3;
            const secondPassTorque = torque * 0.7;
            const thirdPassTorque = torque;

            // Store torque calculation results
            if (!calculationResults) {
                calculationResults = {};
            }
            
            Object.assign(calculationResults, {
                unitId,
                equipmentId,
                lineNumber,
                pipingSpec,
                flangeSize,
                flangeRating,
                boltDiameter,
                boltMaterial: boltMaterialSelect.value,
                temperature: temperatureSelect.value,
                yieldStrength,
                percentYield,
                threadType: threadTypeSelect.value,
                studStressArea,
                lubrication: lubricationConditionSelect.value,
                frictionFactor,
                numberOfBolts,
                stress,
                boltLoad,
                totalBoltLoad,
                torque,
                firstPassTorque,
                secondPassTorque,
                thirdPassTorque
            });

            // Display torque results
            displayTorqueResults(calculationResults);
        }
        
        // Calculate Seating Stress Function
        function calculateSeatingStress() {
            // Get gasket-specific values
            const gasketType = gasketTypeSelect.value;
            const gasketArea = parseFloat(gasketAreaInput.value);
            const minCompressionStress = parseFloat(minCompressionStressInput.value);
            const maxCompressionStress = parseFloat(maxCompressionStressInput.value);
            const internalDesignPressure = parseFloat(internalDesignPressureInput.value) || 0;
            
            // Get total bolt load from torque calculation
            const totalBoltLoad = calculationResults.totalBoltLoad;
            
            // Calculate seating stress
            const seatingStress = totalBoltLoad / gasketArea;
            
            // Determine if seating stress is within recommended range
            let stressStatus = "";
            let stressRecommendation = "";
            
            if (seatingStress < minCompressionStress) {
                stressStatus = `<span class="warning-text">WARNING: Calculated seating stress (${Math.round(seatingStress).toLocaleString()} psi) is below the minimum recommended value (${minCompressionStress.toLocaleString()} psi).</span>`;
                stressRecommendation = "Consider using a higher bolt torque or different gasket type to achieve adequate compression.";
            } else if (seatingStress > maxCompressionStress) {
                stressStatus = `<span class="warning-text">WARNING: Calculated seating stress (${Math.round(seatingStress).toLocaleString()} psi) exceeds the maximum recommended value (${maxCompressionStress.toLocaleString()} psi).</span>`;
                stressRecommendation = "Consider using a lower bolt torque to prevent gasket crushing or damage.";
            } else {
                stressStatus = `<span class="colored-text">GOOD: Calculated seating stress (${Math.round(seatingStress).toLocaleString()} psi) is within the recommended range (${minCompressionStress.toLocaleString()} - ${maxCompressionStress.toLocaleString()} psi).</span>`;
                stressRecommendation = "The calculated torque should provide proper gasket compression.";
            }
            
            // Store gasket calculation results
            Object.assign(calculationResults, {
                gasketType,
                gasketArea,
                minCompressionStress,
                maxCompressionStress,
                internalDesignPressure,
                seatingStress,
                gasketOD: parseFloat(gasketODInput.value),
                gasketID: parseFloat(gasketIDInput.value),
                flangeSeatingOD: parseFloat(flangeSeatingODInput.value) || 0,
                flangeSeatingID: parseFloat(flangeSeatingIDInput.value) || 0
            });
            
            // Display seating stress results
            displaySeatingStressResults(calculationResults, stressStatus, stressRecommendation);
        }

        // Function to display torque results
        function displayTorqueResults(data) {
            // Populate Documentation Information
            const docInfoList = document.getElementById('docInfo');
            docInfoList.innerHTML = `
                <li><span style="font-weight: bold;">Unit ID:</span> ${data.unitId}</li>
                <li><span style="font-weight: bold;">Equipment ID:</span> ${data.equipmentId}</li>
                <li><span style="font-weight: bold;">Line Number:</span> ${data.lineNumber}</li>
                <li><span style="font-weight: bold;">Piping Specification:</span> ${data.pipingSpec}</li>
            `;
            
            // Populate Input Summary
            const inputSummaryList = document.getElementById('inputSummary');
            inputSummaryList.innerHTML = `
                <li><span style="font-weight: bold;">Flange Size:</span> ${getFlangeSize(data.flangeSize)} inch</li>
                <li><span style="font-weight: bold;">Flange Rating:</span> ${getFlangeRating(data.flangeRating)}</li>
                <li><span style="font-weight: bold;">Number of Bolts:</span> ${data.numberOfBolts}</li>
                <li><span style="font-weight: bold;">Bolt Diameter:</span> ${getBoltSizeLabel(data.boltDiameter)} inch</li>
                <li><span style="font-weight: bold;">Bolt Material:</span> ${getMaterialLabel(data.boltMaterial)}</li>
                <li><span style="font-weight: bold;">Temperature:</span> ${getTemperatureLabel(data.temperature)}</li>
                <li><span style="font-weight: bold;">Yield Strength:</span> ${data.yieldStrength.toLocaleString()} psi</li>
                <li><span style="font-weight: bold;">Percentage of Yield:</span> ${(data.percentYield * 100).toFixed(0)}%</li>
                <li><span style="font-weight: bold;">Thread Type:</span> ${data.threadType}</li>
                <li><span style="font-weight: bold;">Stud Stress Area:</span> ${data.studStressArea} sq.in.</li>
                <li><span style="font-weight: bold;">Lubrication:</span> ${getLubricationLabel(data.lubrication)}</li>
            `;
            
            // Populate Calculation Steps
            const calculationStepsList = document.getElementById('calculationSteps');
            calculationStepsList.innerHTML = `
                <li><span style="font-weight: bold;">Stress (S = YS × PY):</span> ${Math.round(data.stress).toLocaleString()} psi</li>
                <li><span style="font-weight: bold;">Bolt Load (BL = S × SA):</span> ${Math.round(data.boltLoad).toLocaleString()} lbs</li>
                <li><span style="font-weight: bold;">Total Bolt Load:</span> ${Math.round(data.totalBoltLoad).toLocaleString()} lbs</li>
            `;
            
            // Populate torque values
            document.getElementById('torqueValue').textContent = `${data.torque.toFixed(2)} ft-lbs`;
            document.getElementById('firstPassTorque').textContent = `${data.firstPassTorque.toFixed(2)} ft-lbs`;
            document.getElementById('secondPassTorque').textContent = `${data.secondPassTorque.toFixed(2)} ft-lbs`;
            document.getElementById('thirdPassTorque').textContent = `${data.thirdPassTorque.toFixed(2)} ft-lbs`;
            
            // Populate formula details
            const formulaDetailsList = document.getElementById('formulaDetails');
            formulaDetailsList.innerHTML = `
                <li>K = Friction Factor (${data.frictionFactor})</li>
                <li>BL = Bolt Load (${Math.round(data.boltLoad).toLocaleString()} lbs)</li>
                <li>BD = Bolt Diameter (${data.boltDiameter} inches)</li>
                <li>Division by 12 converts to foot-pounds</li>
            `;
        }
        
        // Function to display seating stress results
        function displaySeatingStressResults(data, stressStatus, stressRecommendation) {
            // Populate Gasket Information
            const gasketInfoList = document.getElementById('gasketInfo');
            gasketInfoList.innerHTML = `
                <li><span style="font-weight: bold;">Gasket Type:</span> ${getGasketTypeLabel(data.gasketType)}</li>
                <li><span style="font-weight: bold;">Gasket OD:</span> ${data.gasketOD.toFixed(3)} inches</li>
                <li><span style="font-weight: bold;">Gasket ID:</span> ${data.gasketID.toFixed(3)} inches</li>
                <li><span style="font-weight: bold;">Gasket Area:</span> ${data.gasketArea.toFixed(4)} sq.in.</li>
                <li><span style="font-weight: bold;">Min. Compression Stress:</span> ${data.minCompressionStress.toLocaleString()} psi</li>
                <li><span style="font-weight: bold;">Max. Compression Stress:</span> ${data.maxCompressionStress.toLocaleString()} psi</li>
                ${data.internalDesignPressure ? `<li><span style="font-weight: bold;">Internal Design Pressure:</span> ${data.internalDesignPressure.toFixed(1)} psi</li>` : ''}
            `;
            
            // Populate Seating Calculations
            const seatingCalculationsList = document.getElementById('seatingCalculations');
            seatingCalculationsList.innerHTML = `
                <li><span style="font-weight: bold;">Total Bolt Load:</span> ${Math.round(data.totalBoltLoad).toLocaleString()} lbs</li>
                <li><span style="font-weight: bold;">Gasket Area:</span> ${data.gasketArea.toFixed(4)} sq.in.</li>
                <li><span style="font-weight: bold;">Seating Stress Calculation:</span> ${Math.round(data.totalBoltLoad).toLocaleString()} lbs ÷ ${data.gasketArea.toFixed(4)} sq.in.</li>
            `;
            
            // Populate seating stress value
            document.getElementById('seatingStressValue').textContent = `${Math.round(data.seatingStress).toLocaleString()} psi`;
            
            // Populate stress status and recommendation
            document.getElementById('stressStatus').innerHTML = stressStatus;
            document.getElementById('stressRecommendation').textContent = stressRecommendation;
            
            // Populate seating stress formula details
            const stressFormulaDetailsList = document.getElementById('stressFormulaDetails');
            stressFormulaDetailsList.innerHTML = `
                <li>TOTAL BOLT LOAD = ${Math.round(data.totalBoltLoad).toLocaleString()} lbs</li>
                <li>GASKET AREA = ${data.gasketArea.toFixed(4)} sq.in.</li>
                <li>${Math.round(data.totalBoltLoad).toLocaleString()} ÷ ${data.gasketArea.toFixed(4)} = ${Math.round(data.seatingStress).toLocaleString()} psi</li>
            `;
        }

        // Function to export results to PDF
        function exportToPdf() {
            if (!calculationResults) {
                alert("Please calculate torque values first.");
                return;
            }

            // Create PDF document using jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.setTextColor(0, 70, 173);
            doc.text("Honeywell Bolt Torque Calculator", 105, 15, null, null, "center");
            
            // Add subtitle
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text("Based on Honeywell SOP-MNT-539 Bolt Torque Procedure", 105, 22, null, null, "center");
            
            // Add date
            doc.setFontSize(10);
            doc.text(`Generated: ${new Date().toLocaleString()}`, 105, 28, null, null, "center");
            
            // Add horizontal line
            doc.setDrawColor(200, 200, 200);
            doc.line(20, 32, 190, 32);
            
            // Documentation Information Section
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text("Documentation Information", 20, 40);
            
            doc.setFontSize(10);
            let yPos = 45;
            
            // Function to add key-value pair to PDF
            function addKeyValue(key, value) {
                doc.setFont(undefined, 'bold');
                doc.text(`${key}:`, 25, yPos);
                doc.setFont(undefined, 'normal');
                doc.text(value, 105, yPos);
                yPos += 6;
            }
            
            // Documentation info in requested order
            addKeyValue("Unit ID", calculationResults.unitId);
            addKeyValue("Equipment ID", calculationResults.equipmentId);
            addKeyValue("Line Number", calculationResults.lineNumber);
            addKeyValue("Piping Specification", calculationResults.pipingSpec);
            
            // Add some spacing
            yPos += 3;
            
            // Flange & Bolt Information
            doc.setFontSize(14);
            doc.text("Flange & Bolt Information", 20, yPos);
            yPos += 5;
            
            doc.setFontSize(10);
            
            addKeyValue("Flange Size", `${getFlangeSize(calculationResults.flangeSize)} inch`);
            addKeyValue("Flange Rating", getFlangeRating(calculationResults.flangeRating));
            addKeyValue("Number of Bolts", calculationResults.numberOfBolts.toString());
            addKeyValue("Bolt Diameter", `${getBoltSizeLabel(calculationResults.boltDiameter)} inch`);
            addKeyValue("Bolt Material", getMaterialLabel(calculationResults.boltMaterial));
            addKeyValue("Temperature", getTemperatureLabel(calculationResults.temperature));
            addKeyValue("Yield Strength", `${calculationResults.yieldStrength.toLocaleString()} psi`);
            addKeyValue("Percentage of Yield", `${(calculationResults.percentYield * 100).toFixed(0)}%`);
            addKeyValue("Thread Type", calculationResults.threadType);
            addKeyValue("Stud Stress Area", `${calculationResults.studStressArea} sq.in.`);
            addKeyValue("Lubrication", getLubricationLabel(calculationResults.lubrication));
            
            // Add Gasket Information if available
            if (calculationResults.gasketType) {
                // Add some spacing
                yPos += 3;
                
                // Gasket Information Section
                doc.setFontSize(14);
                doc.text("Gasket Information", 20, yPos);
                yPos += 5;
                
                doc.setFontSize(10);
                
                addKeyValue("Gasket Type", getGasketTypeLabel(calculationResults.gasketType));
                addKeyValue("Gasket OD", `${calculationResults.gasketOD.toFixed(3)} inches`);
                addKeyValue("Gasket ID", `${calculationResults.gasketID.toFixed(3)} inches`);
                addKeyValue("Gasket Area", `${calculationResults.gasketArea.toFixed(4)} sq.in.`);
                
                if (calculationResults.flangeSeatingOD && calculationResults.flangeSeatingID) {
                    addKeyValue("Flange Seating OD", `${calculationResults.flangeSeatingOD.toFixed(3)} inches`);
                    addKeyValue("Flange Seating ID", `${calculationResults.flangeSeatingID.toFixed(3)} inches`);
                }
                
                addKeyValue("Min. Compression Stress", `${calculationResults.minCompressionStress.toLocaleString()} psi`);
                addKeyValue("Max. Compression Stress", `${calculationResults.maxCompressionStress.toLocaleString()} psi`);
                
                if (calculationResults.internalDesignPressure) {
                    addKeyValue("Internal Design Pressure", `${calculationResults.internalDesignPressure.toFixed(1)} psi`);
                }
            }
            
            // Check if we need a new page
            if (yPos > 230) {
                doc.addPage();
                yPos = 40;
            }
            
            // Add some spacing
            yPos += 3;
            
            // Calculation Steps Section
            doc.setFontSize(14);
            doc.text("Calculation Steps", 20, yPos);
            yPos += 5;
            
            doc.setFontSize(10);
            
            addKeyValue("Stress (S = YS × PY)", `${Math.round(calculationResults.stress).toLocaleString()} psi`);
            addKeyValue("Bolt Load (BL = S × SA)", `${Math.round(calculationResults.boltLoad).toLocaleString()} lbs`);
            addKeyValue("Total Bolt Load", `${Math.round(calculationResults.totalBoltLoad).toLocaleString()} lbs`);
            
            // Add some spacing
            yPos += 3;
            
            // Torque Values Section
            doc.setFontSize(14);
            doc.text("Torque Values", 20, yPos);
            yPos += 10;
            
            // Main torque value
            doc.setFontSize(16);
            doc.setTextColor(21, 87, 36);
            doc.text(`${calculationResults.torque.toFixed(2)} ft-lbs`, 25, yPos);
            
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text("Recommended Torque", 25, yPos + 5);
            
            yPos += 15;
            
            // Torque passes
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            
            addKeyValue("Pass 1 (30%)", `${calculationResults.firstPassTorque.toFixed(2)} ft-lbs`);
            addKeyValue("Pass 2 (70%)", `${calculationResults.secondPassTorque.toFixed(2)} ft-lbs`);
            addKeyValue("Pass 3 (100%)", `${calculationResults.thirdPassTorque.toFixed(2)} ft-lbs`);
            
            // Check if we need a new page for seating stress (if gasket info available)
            if (calculationResults.gasketType) {
                if (yPos > 210) {
                    doc.addPage();
                    yPos = 40;
                } else {
                    // Add some spacing
                    yPos += 5;
                }
                
                // Seating Stress Section
                doc.setFontSize(14);
                doc.text("Gasket Seating Stress", 20, yPos);
                yPos += 10;
                
                // Seating stress value
                doc.setFontSize(16);
                doc.setTextColor(0, 70, 173);
                doc.text(`${Math.round(calculationResults.seatingStress).toLocaleString()} psi`, 25, yPos);
                
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text("Calculated Seating Stress", 25, yPos + 5);
                
                yPos += 15;
                
                // Status
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                
                // Determine status color
                if (calculationResults.seatingStress < calculationResults.minCompressionStress ||
                    calculationResults.seatingStress > calculationResults.maxCompressionStress) {
                    doc.setTextColor(220, 53, 69); // warning color
                } else {
                    doc.setTextColor(21, 87, 36); // success color
                }
                
                // Status text
                let statusText = "";
                if (calculationResults.seatingStress < calculationResults.minCompressionStress) {
                    statusText = `WARNING: Calculated seating stress (${Math.round(calculationResults.seatingStress).toLocaleString()} psi) is below the minimum recommended value (${calculationResults.minCompressionStress.toLocaleString()} psi).`;
                } else if (calculationResults.seatingStress > calculationResults.maxCompressionStress) {
                    statusText = `WARNING: Calculated seating stress (${Math.round(calculationResults.seatingStress).toLocaleString()} psi) exceeds the maximum recommended value (${calculationResults.maxCompressionStress.toLocaleString()} psi).`;
                } else {
                    statusText = `GOOD: Calculated seating stress (${Math.round(calculationResults.seatingStress).toLocaleString()} psi) is within the recommended range (${calculationResults.minCompressionStress.toLocaleString()} - ${calculationResults.maxCompressionStress.toLocaleString()} psi).`;
                }
                
                doc.text(statusText, 25, yPos);
                yPos += 10;
                
                // Reset text color
                doc.setTextColor(0, 0, 0);
                
                // Recommendation text
                let recommendationText = "";
                if (calculationResults.seatingStress < calculationResults.minCompressionStress) {
                    recommendationText = "Consider using a higher bolt torque or different gasket type to achieve adequate compression.";
                } else if (calculationResults.seatingStress > calculationResults.maxCompressionStress) {
                    recommendationText = "Consider using a lower bolt torque to prevent gasket crushing or damage.";
                } else {
                    recommendationText = "The calculated torque should provide proper gasket compression.";
                }
                
                doc.text(recommendationText, 25, yPos);
            }
            
            // Formula Section - add to a new page if needed
            if (yPos > 220) {
                doc.addPage();
                yPos = 40;
            } else {
                yPos += 20;
            }
            
            // Torque Formula
            doc.setFontSize(14);
            doc.text("Torque Formula Used", 20, yPos);
            yPos += 10;
            
            // Draw formula box
            doc.setFillColor(248, 249, 250);
            doc.setDrawColor(230, 230, 230);
            doc.roundedRect(25, yPos - 5, 160, 10, 1, 1, 'FD');
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text("TORQUE (T) = K × BL × (BD/12)", 105, yPos, null, null, "center");
            
            yPos += 15;
            
            doc.setFontSize(10);
            doc.text("Where:", 25, yPos);
            yPos += 5;
            
            doc.text(`K = Friction Factor (${calculationResults.frictionFactor})`, 30, yPos);
            yPos += 5;
            doc.text(`BL = Bolt Load (${Math.round(calculationResults.boltLoad).toLocaleString()} lbs)`, 30, yPos);
            yPos += 5;
            doc.text(`BD = Bolt Diameter (${calculationResults.boltDiameter} inches)`, 30, yPos);
            yPos += 5;
            doc.text("Division by 12 converts to foot-pounds", 30, yPos);
            
            // Add seating stress formula if applicable
            if (calculationResults.gasketType) {
                yPos += 15;
                
                // Seating stress formula
                doc.setFontSize(14);
                doc.text("Seating Stress Formula", 20, yPos);
                yPos += 10;
                
                // Draw formula box
                doc.setFillColor(248, 249, 250);
                doc.setDrawColor(230, 230, 230);
                doc.roundedRect(25, yPos - 5, 160, 10, 1, 1, 'FD');
                
                doc.setFontSize(12);
                doc.text("SEATING STRESS = TOTAL BOLT LOAD / GASKET AREA", 105, yPos, null, null, "center");
                
                yPos += 15;
                
                doc.setFontSize(10);
                doc.text("Where:", 25, yPos);
                yPos += 5;
                
                doc.text(`TOTAL BOLT LOAD = ${Math.round(calculationResults.totalBoltLoad).toLocaleString()} lbs`, 30, yPos);
                yPos += 5;
                doc.text(`GASKET AREA = ${calculationResults.gasketArea.toFixed(4)} sq.in.`, 30, yPos);
                yPos += 5;
                doc.text(`${Math.round(calculationResults.totalBoltLoad).toLocaleString()} ÷ ${calculationResults.gasketArea.toFixed(4)} = ${Math.round(calculationResults.seatingStress).toLocaleString()} psi`, 30, yPos);
            }
            
            // Add footer notes
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                
                yPos = 285;
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text("Page " + i + " of " + pageCount, 180, 290);
                
                if (i === pageCount) {  // Only add notes on the last page
                    doc.text("Notes:", 20, yPos);
                    yPos += 5;
                    doc.text("• Follow the Honeywell Bolt Torque Procedure SOP-MNT-539 for proper torquing sequence.", 25, yPos);
                    yPos += 5;
                    doc.text("• For critical applications, always consult with engineering.", 25, yPos);
                }
            }
            
            // Save the PDF
            doc.save("HoneywellBoltTorqueCalculation.pdf");
        }

        // Helper functions for labels
        function getFlangeSize(size) {
            return size;
        }

        function getFlangeRating(rating) {
            return rating === 'RTJ' ? 'RTJ (Ring Type Joint)' : `Class ${rating}`;
        }

        function getBoltSizeLabel(size) {
            const sizeMap = {
                '0.25': '1/4',
                '0.3125': '5/16',
                '0.375': '3/8',
                '0.4375': '7/16',
                '0.5': '1/2',
                '0.5625': '9/16',
                '0.625': '5/8',
                '0.75': '3/4',
                '0.875': '7/8',
                '1': '1',
                '1.125': '1-1/8',
                '1.25': '1-1/4',
                '1.375': '1-3/8',
                '1.5': '1-1/2'
            };
            return sizeMap[size] || size;
        }

        function getMaterialLabel(material) {
    const materialMap = {
        'a193_b7': 'A-193 B7 (Chrome-Moly Alloy Steel)',
        'a193_b7m': 'A-193 B7M (Chrome-Moly Alloy Steel)',
        'a320_l7m': 'A-320 L7M (Low Temp Chrome-Moly Steel)',
        'a193_b8': 'A-193 B8 (304 Stainless Steel)'
    };
    return materialMap[material] || material;
}

        function getTemperatureLabel(temp) {
            const tempMap = {
                '-20_100': '-20 to 100 °F',
                '200': '200 °F',
                '300': '300 °F',
                '400': '400 °F',
                '500': '500 °F',
                '600': '600 °F',
                '700': '700 °F'
            };
            return tempMap[temp] || temp;
        }

        function getLubricationLabel(lub) {
            const lubMap = {
                'dry': 'Dry (Carbon Steel on Carbon steel)',
                'never_seize': 'Never-Seize (paste)',
                'teflon': 'Teflon Coating',
                'moly': 'Moly Paste'
            };
            return lubMap[lub] || lub;
        }
        
       function getGasketTypeLabel(type) {
    const typeMap = {
        'none': 'None',
        'taskline': 'Taskline',
        'kammprofile': 'Kammprofile',
        'spiral': 'Spiral Wound',
        'full-face': 'Full Face',
        'ring': 'Ring Type',
        'rtj': 'RTJ (Ring Type Joint)',
        'gore_upg': 'Gore UPG'
    };
    return typeMap[type] || type;
}

        // Initialize any dependent fields
        updateBoltDiameterGasket();
    </script>
</body>
</html>
